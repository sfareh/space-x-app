{"version":3,"file":"tools.mjs","sources":["../../../../../../modules/common/tools/src/inline-css-processor.ts","../../../../../../modules/common/tools/public_api.ts","../../../../../../modules/common/tools/index.ts","../../../../../../modules/common/tools/tools.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport Critters from 'critters';\nimport * as fs from 'fs';\n\nexport interface InlineCriticalCssProcessOptions {\n  outputPath?: string;\n}\n\nexport interface InlineCriticalCssProcessorOptions {\n  minify?: boolean;\n  deployUrl?: string;\n}\n\nexport interface InlineCriticalCssResult {\n  content: string;\n  warnings?: string[];\n  errors?: string[];\n}\n\nclass CrittersExtended extends Critters {\n  readonly warnings: string[] = [];\n  readonly errors: string[] = [];\n\n  constructor(\n    private readonly optionsExtended: InlineCriticalCssProcessorOptions &\n      InlineCriticalCssProcessOptions,\n    private readonly resourceCache: Map<string, string>,\n  ) {\n    super({\n      logger: {\n        warn: (s: string) => this.warnings.push(s),\n        error: (s: string) => this.errors.push(s),\n        info: () => {},\n      },\n      logLevel: 'warn',\n      path: optionsExtended.outputPath,\n      publicPath: optionsExtended.deployUrl,\n      compress: !!optionsExtended.minify,\n      pruneSource: false,\n      reduceInlineStyles: false,\n      mergeStylesheets: false,\n      preload: 'media',\n      noscriptFallback: true,\n      inlineFonts: true,\n    });\n  }\n\n  public override async readFile(path: string): Promise<string> {\n    let resourceContent = this.resourceCache.get(path);\n    if (resourceContent === undefined) {\n      resourceContent = await fs.promises.readFile(path, 'utf-8');\n      this.resourceCache.set(path, resourceContent);\n    }\n\n    return resourceContent;\n  }\n}\n\nexport class InlineCriticalCssProcessor {\n  private readonly resourceCache = new Map<string, string>();\n\n  constructor(protected readonly options: InlineCriticalCssProcessorOptions) {}\n\n  async process(\n    html: string,\n    options: InlineCriticalCssProcessOptions,\n  ): Promise<InlineCriticalCssResult> {\n    const critters = new CrittersExtended({ ...this.options, ...options }, this.resourceCache);\n    const content = await critters.process(html);\n\n    return {\n      content,\n      errors: critters.errors.length ? critters.errors : undefined,\n      warnings: critters.warnings.length ? critters.warnings : undefined,\n    };\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport { InlineCriticalCssProcessor as ÉµInlineCriticalCssProcessor } from './src/inline-css-processor';\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport * from './public_api';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;AA0BA,MAAM,yBAAyB,QAAQ;IAIrC,YACmB,eACgB,EAChB,aAAkC;QAEnD,KAAK,CAAC;YACJ,MAAM,EAAE;gBACN,IAAI,EAAE,CAAC,CAAS,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;gBAC1C,KAAK,EAAE,CAAC,CAAS,KAAK,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;gBACzC,IAAI,EAAE,SAAQ;aACf;YACD,QAAQ,EAAE,MAAM;YAChB,IAAI,EAAE,eAAe,CAAC,UAAU;YAChC,UAAU,EAAE,eAAe,CAAC,SAAS;YACrC,QAAQ,EAAE,CAAC,CAAC,eAAe,CAAC,MAAM;YAClC,WAAW,EAAE,KAAK;YAClB,kBAAkB,EAAE,KAAK;YACzB,gBAAgB,EAAE,KAAK;YACvB,OAAO,EAAE,OAAO;YAChB,gBAAgB,EAAE,IAAI;YACtB,WAAW,EAAE,IAAI;SAClB,CAAC,CAAC;QApBc,oBAAe,GAAf,eAAe,CACC;QAChB,kBAAa,GAAb,aAAa,CAAqB;QAN5C,aAAQ,GAAa,EAAE,CAAC;QACxB,WAAM,GAAa,EAAE,CAAC;KAwB9B;IAEqB,QAAQ,CAAC,IAAY;;YACzC,IAAI,eAAe,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACnD,IAAI,eAAe,KAAK,SAAS,EAAE;gBACjC,eAAe,GAAG,MAAM,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;gBAC5D,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;aAC/C;YAED,OAAO,eAAe,CAAC;SACxB;KAAA;CACF;MAEY,0BAA0B;IAGrC,YAA+B,OAA0C;QAA1C,YAAO,GAAP,OAAO,CAAmC;QAFxD,kBAAa,GAAG,IAAI,GAAG,EAAkB,CAAC;KAEkB;IAEvE,OAAO,CACX,IAAY,EACZ,OAAwC;;YAExC,MAAM,QAAQ,GAAG,IAAI,gBAAgB,iCAAM,IAAI,CAAC,OAAO,GAAK,OAAO,GAAI,IAAI,CAAC,aAAa,CAAC,CAAC;YAC3F,MAAM,OAAO,GAAG,MAAM,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAE7C,OAAO;gBACL,OAAO;gBACP,MAAM,EAAE,QAAQ,CAAC,MAAM,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,GAAG,SAAS;gBAC5D,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,GAAG,SAAS;aACnE,CAAC;SACH;KAAA;;;AClFH;;;;;;;;ACAA;;;;;;;;ACAA;;;;;;"}